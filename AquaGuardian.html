<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AquaGuardian V4 - Ultimate Groundwater Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .header h1 {
            font-size: 2.5rem;
            color: #2c5aa0;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-left: 10px;
        }

        .control-panel {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .scenario-display {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .scenario-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #74b9ff, #0984e3, #00b894);
        }

        .scenario-title {
            font-size: 1.6rem;
            color: #2c5aa0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .scenario-description {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-size: 1.1rem;
            line-height: 1.6;
            border-left: 5px solid #74b9ff;
        }

        .choice-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .choice-btn {
            padding: 18px 20px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .choice-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .choice-btn:hover::before {
            left: 100%;
        }

        .choice-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(116, 185, 255, 0.4);
        }

        .choice-btn.good {
            background: linear-gradient(135deg, #00b894, #00a085);
        }

        .choice-btn.bad {
            background: linear-gradient(135deg, #e17055, #d63031);
        }

        .choice-btn.excellent {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .stats-panel, .tools-panel, .leaderboard-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .water-tank {
            width: 100px;
            height: 140px;
            border: 5px solid #2c5aa0;
            border-radius: 0 0 20px 20px;
            background: linear-gradient(to top, #E3F2FD 0%, #BBDEFB 100%);
            position: relative;
            margin: 0 auto 20px;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }

        .water-level-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, #1976D2, #42A5F5, #64B5F6);
            transition: height 1s ease;
            border-radius: 0 0 15px 15px;
            position: relative;
        }

        .water-level-fill::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 0;
            right: 0;
            height: 10px;
            background: rgba(255,255,255,0.3);
            border-radius: 50px;
            animation: waterWave 3s ease-in-out infinite;
        }

        @keyframes waterWave {
            0%, 100% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
        }

        .tank-label {
            text-align: center;
            font-size: 1rem;
            font-weight: 700;
            color: #2c5aa0;
            margin-bottom: 15px;
        }

        .eco-coins {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1.4rem;
            font-weight: bold;
            color: #f39c12;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-radius: 15px;
            border: 2px solid #f39c12;
        }

        .panel-title {
            font-size: 1.3rem;
            color: #2c5aa0;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 12px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .tool-btn {
            display: block;
            width: 100%;
            margin-bottom: 12px;
            padding: 15px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .tool-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .tool-btn:hover::before {
            left: 100%;
        }

        .tool-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.4);
        }

        .tool-btn.active {
            background: linear-gradient(135deg, #00b894, #00a085);
            box-shadow: 0 5px 15px rgba(0, 184, 148, 0.4);
        }

        .aquifer-container {
            position: relative;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            height: 650px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .ground-layers {
            position: relative;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, 
                #87CEEB 0%, 
                #87CEEB 15%, 
                #8B4513 15%, 
                #8B4513 25%, 
                #D2691E 25%, 
                #D2691E 40%, 
                #A0522D 40%, 
                #A0522D 60%, 
                #4682B4 60%, 
                #4682B4 100%);
            border-radius: 20px;
            cursor: crosshair;
            position: relative;
            overflow: hidden;
        }

        .layer-label {
            position: absolute;
            right: 15px;
            color: white;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            font-size: 1rem;
            background: rgba(0,0,0,0.3);
            padding: 5px 10px;
            border-radius: 8px;
        }

        .sky { top: 5%; }
        .topsoil { top: 20%; }
        .clay { top: 32%; }
        .sand { top: 50%; }
        .aquifer { top: 80%; }

        .well {
            position: absolute;
            width: 10px;
            background: linear-gradient(to bottom, #666, #333);
            border-radius: 5px;
            z-index: 10;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .well:hover {
            background: linear-gradient(to bottom, #333, #000);
            width: 14px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .well-head {
            position: absolute;
            top: -20px;
            left: -10px;
            width: 30px;
            height: 20px;
            background: linear-gradient(135deg, #444, #222);
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }

        .water-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: radial-gradient(circle, #4FC3F7, #2196F3);
            border-radius: 50%;
            animation: waterFlow 4s linear infinite;
            z-index: 5;
            box-shadow: 0 0 10px rgba(79, 195, 247, 0.6);
        }

        @keyframes waterFlow {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(30px) scale(0.5); }
        }

        .rain-drop {
            position: absolute;
            width: 3px;
            height: 15px;
            background: linear-gradient(to bottom, transparent, #4FC3F7, #2196F3);
            animation: rainfall 2.5s linear infinite;
            border-radius: 0 0 50% 50%;
        }

        @keyframes rainfall {
            0% { top: -15px; opacity: 1; }
            100% { top: 15%; opacity: 0; }
        }

        .contamination {
            position: absolute;
            width: 25px;
            height: 25px;
            background: radial-gradient(circle, #ff6b6b, rgba(255, 107, 107, 0.3));
            border-radius: 50%;
            animation: contaminate 5s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
        }

        @keyframes contaminate {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.8); opacity: 0.4; }
        }

        .recharge-system {
            position: absolute;
            width: 25px;
            height: 25px;
            background: radial-gradient(circle, #27ae60, #2ecc71);
            border-radius: 50%;
            border: 4px solid #2ecc71;
            animation: recharge 3s ease-in-out infinite;
            box-shadow: 0 0 15px rgba(39, 174, 96, 0.6);
        }

        @keyframes recharge {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .monitor {
            position: absolute;
            width: 18px;
            height: 18px;
            background: linear-gradient(135deg, #f39c12, #e67e22);
            border-radius: 4px;
            border: 3px solid #e67e22;
            animation: monitor 2s ease-in-out infinite;
            box-shadow: 0 0 10px rgba(243, 156, 18, 0.6);
        }

        @keyframes monitor {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .barrier {
            position: absolute;
            width: 12px;
            height: 50px;
            background: linear-gradient(to bottom, #95a5a6, #7f8c8d);
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .weather-control {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 10px;
        }

        .weather-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .weather-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .weather-btn.sunny { background: linear-gradient(135deg, #f39c12, #e67e22); color: white; }
        .weather-btn.rainy { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
        .weather-btn.drought { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }

        .weather-btn.active {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .progress-bars {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .progress-label {
            font-size: 1.1rem;
            margin-bottom: 10px;
            font-weight: 700;
            color: #2c5aa0;
        }

        .progress-track {
            background: #ecf0f1;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.8s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .water-level { background: linear-gradient(90deg, #3498db, #2980b9); }
        .contamination-level { background: linear-gradient(90deg, #e74c3c, #c0392b); }
        .sustainability { background: linear-gradient(90deg, #27ae60, #229954); }

        .achievements {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .achievement-badge {
            padding: 12px 15px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border-radius: 25px;
            font-size: 0.95rem;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .achievement-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .achievement-badge:hover::before {
            left: 100%;
        }

        .achievement-badge.locked {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            opacity: 0.7;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.98);
            padding: 20px 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transform: translateX(450px);
            transition: transform 0.4s ease;
            z-index: 1000;
            max-width: 350px;
            font-weight: 600;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { border-left: 6px solid #27ae60; }
        .notification.warning { border-left: 6px solid #f39c12; }
        .notification.danger { border-left: 6px solid #e74c3c; }

        .mini-map {
            position: absolute;
            bottom: 25px;
            right: 25px;
            width: 180px;
            height: 120px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 15px;
            border: 3px solid #2c5aa0;
        }

        .mini-aquifer {
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #87CEEB 20%, #4682B4 80%);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .mode-switcher {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .mode-btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #00b894, #00a085);
            transform: scale(1.05);
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.4);
        }

        .quiz-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .quiz-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .quiz-question {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            font-size: 1.3rem;
            font-weight: 600;
            line-height: 1.6;
            border-left: 5px solid #74b9ff;
            color: #2c3e50;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .quiz-option {
            padding: 18px 20px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .quiz-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .quiz-option:hover::before {
            left: 100%;
        }

        .quiz-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(116, 185, 255, 0.4);
        }

        .quiz-option.correct {
            background: linear-gradient(135deg, #00b894, #00a085);
            animation: pulse 1s ease-in-out;
        }

        .quiz-option.incorrect {
            background: linear-gradient(135deg, #e17055, #d63031);
            animation: shake 0.5s ease-in-out;
        }

        .quiz-option.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .quiz-explanation {
            background: linear-gradient(135deg, #dff0d8, #d4edda);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #27ae60;
        }

        .explanation-text {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .quiz-results {
            text-align: center;
            padding: 30px;
        }

        .quiz-final-score {
            font-size: 3rem;
            font-weight: bold;
            color: #2c5aa0;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .quiz-performance {
            font-size: 1.3rem;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-weight: 600;
        }

        .quiz-performance.excellent {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border: 2px solid #27ae60;
        }

        .quiz-performance.good {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
            border: 2px solid #f39c12;
        }

        .quiz-performance.needs-improvement {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border: 2px solid #e74c3c;
        }

        @media (max-width: 1200px) {
            .control-panel {
                grid-template-columns: 1fr;
            }
            
            .aquifer-container {
                height: 500px;
            }
        }

        @media (max-width: 768px) {
            .choice-buttons {
                grid-template-columns: 1fr;
            }
            
            .progress-bars {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>🌊 AquaGuardian <span class="version-badge">V4 Ultimate</span></h1>
            <p>The Complete Groundwater Conservation Experience - Scenarios + Simulation + Management</p>
        </div>

        <div class="mode-switcher">
            <button class="mode-btn active" id="scenario-mode-btn" onclick="switchMode('scenario')">
                🌍 Scenario Mode
            </button>
            <button class="mode-btn" id="sandbox-mode-btn" onclick="switchMode('sandbox')">
                🛠️ Sandbox Mode
            </button>
            <button class="mode-btn" id="quiz-mode-btn" onclick="switchMode('quiz')">
                🧠 Quiz Mode
            </button>
        </div>

        <div class="control-panel">
            <div class="stats-panel">
                <div class="panel-title">📊 Ecosystem Status</div>
                <div class="stat-item">
                    <span>💧 Water Level:</span>
                    <span id="water-level">85%</span>
                </div>
                <div class="stat-item">
                    <span>⚠️ Contamination:</span>
                    <span id="contamination-level">5%</span>
                </div>
                <div class="stat-item">
                    <span>🏆 Score:</span>
                    <span id="score">1000</span>
                </div>
                <div class="stat-item">
                    <span>💰 Budget:</span>
                    <span id="budget">$50,000</span>
                </div>
                <div class="stat-item">
                    <span>🏠 Population:</span>
                    <span id="population">25,000</span>
                </div>

                <div class="panel-title" style="margin-top: 20px;">🌤️ Weather Control</div>
                <div class="weather-control">
                    <button class="weather-btn sunny active" id="sunny-btn" onclick="setWeather('sunny')">☀️</button>
                    <button class="weather-btn rainy" id="rainy-btn" onclick="setWeather('rainy')">🌧️</button>
                    <button class="weather-btn drought" id="drought-btn" onclick="setWeather('drought')">🏜️</button>
                </div>
                <div class="stat-item">
                    <span>Current Weather:</span>
                    <span id="current-weather">Sunny</span>
                </div>
            </div>

            <div class="scenario-display" id="scenario-panel">
                <div class="scenario-title">
                    <span id="scenario-icon">🌍</span>
                    <span id="scenario-title-text">Drought Crisis Challenge</span>
                </div>
                
                <div class="scenario-description" id="scenario-description">
                    A severe drought has hit your region for the third consecutive year. Groundwater levels are dropping rapidly, agricultural demands are increasing, and the community is demanding immediate action. Your decisions will impact thousands of lives and the ecosystem for decades.
                </div>

                <div class="choice-buttons" id="choice-buttons">
                    <button class="choice-btn" onclick="makeChoice(0)">
                        💧 Implement strict water rationing and conservation programs
                    </button>
                    <button class="choice-btn" onclick="makeChoice(1)">
                        ⛏️ Drill deeper wells to access confined aquifers
                    </button>
                    <button class="choice-btn" onclick="makeChoice(2)">
                        🚛 Import water from neighboring regions at high cost
                    </button>
                    <button class="choice-btn" onclick="makeChoice(3)">
                        🌧️ Invest in advanced rainwater harvesting systems
                    </button>
                </div>

                <div class="tank-label">Water Ecosystem Health Meter</div>
                <div class="water-tank">
                    <div class="water-level-fill" id="water-tank-fill" style="height: 85%"></div>
                </div>

                <div class="eco-coins">
                    <span>🪙</span>
                    <span id="eco-coins">1000</span>
                    <span>Eco-Coins</span>
                </div>
            </div>

            <div class="tools-panel" id="sandbox-panel" style="display: none;">
                <div class="panel-title">🛠️ Management Tools</div>
                <button class="tool-btn" id="drill-btn" onclick="selectTool('drill')">
                    ⛏️ Drill Well ($5,000)
                </button>
                <button class="tool-btn" id="cleanup-btn" onclick="selectTool('cleanup')">
                    🧹 Clean Contamination ($3,000)
                </button>
                <button class="tool-btn" id="recharge-btn" onclick="selectTool('recharge')">
                    💧 Install Recharge System ($8,000)
                </button>
                <button class="tool-btn" id="monitor-btn" onclick="selectTool('monitor')">
                    📡 Place Monitor ($2,000)
                </button>
                <button class="tool-btn" id="barrier-btn" onclick="selectTool('barrier')">
                    🛡️ Pollution Barrier ($6,000)
                </button>
                <button class="tool-btn" id="treatment-btn" onclick="selectTool('treatment')">
                    🏭 Water Treatment Plant ($15,000)
                </button>
            </div>

            <div class="quiz-panel" id="quiz-panel" style="display: none;">
                <div class="scenario-title">
                    <span id="quiz-icon">🧠</span>
                    <span id="quiz-title-text">Groundwater Knowledge Quiz</span>
                </div>
                
                <div class="quiz-stats">
                    <div class="stat-item">
                        <span>📊 Question:</span>
                        <span id="quiz-progress">1 / 10</span>
                    </div>
                    <div class="stat-item">
                        <span>✅ Correct:</span>
                        <span id="quiz-score">0</span>
                    </div>
                    <div class="stat-item">
                        <span>⏱️ Time:</span>
                        <span id="quiz-timer">30s</span>
                    </div>
                </div>

                <div class="quiz-question" id="quiz-question">
                    Which layer of soil typically contains the most groundwater?
                </div>

                <div class="quiz-options" id="quiz-options">
                    <button class="quiz-option" onclick="selectQuizAnswer(0)">
                        A) Topsoil layer
                    </button>
                    <button class="quiz-option" onclick="selectQuizAnswer(1)">
                        B) Clay layer
                    </button>
                    <button class="quiz-option" onclick="selectQuizAnswer(2)">
                        C) Sand and gravel layer (aquifer)
                    </button>
                    <button class="quiz-option" onclick="selectQuizAnswer(3)">
                        D) Bedrock layer
                    </button>
                </div>

                <div class="quiz-explanation" id="quiz-explanation" style="display: none;">
                    <div class="explanation-text" id="explanation-text"></div>
                    <button class="choice-btn" id="next-question-btn" onclick="nextQuestion()" style="margin-top: 15px;">
                        Next Question ➡️
                    </button>
                </div>

                <div class="quiz-results" id="quiz-results" style="display: none;">
                    <div class="scenario-title">
                        <span>🏆</span>
                        <span>Quiz Complete!</span>
                    </div>
                    <div class="quiz-final-score" id="final-score-display"></div>
                    <div class="quiz-performance" id="performance-message"></div>
                    <button class="choice-btn" onclick="restartQuiz()" style="margin-top: 20px;">
                        🔄 Take Quiz Again
                    </button>
                </div>
            </div>

            <div class="leaderboard-panel">
                <div class="panel-title">🏆 Global Leaderboard</div>
                <div class="leaderboard-list">
                    <div class="stat-item" style="background: linear-gradient(135deg, #ffd700, #ffed4e); color: #333;">
                        <span>🥇 EcoWarrior</span>
                        <span>4,250</span>
                    </div>
                    <div class="stat-item" style="background: linear-gradient(135deg, #c0c0c0, #ddd); color: #333;">
                        <span>🥈 WaterSaver</span>
                        <span>3,180</span>
                    </div>
                    <div class="stat-item" style="background: linear-gradient(135deg, #cd7f32, #daa520); color: #333;">
                        <span>🥉 AquaHero</span>
                        <span>2,920</span>
                    </div>
                    <div class="stat-item" style="background: linear-gradient(135deg, #e8f5e8, #d4edda);">
                        <span><strong>👤 You</strong></span>
                        <span id="player-rank">1000</span>
                    </div>
                </div>
                
                <div class="panel-title" style="margin-top: 25px;">🎯 Achievements</div>
                <div class="achievements">
                    <div class="achievement-badge" id="badge-1">🌱 Conservation Starter</div>
                    <div class="achievement-badge locked" id="badge-2">💧 Water Guardian</div>
                    <div class="achievement-badge locked" id="badge-3">🏆 Sustainability Master</div>
                    <div class="achievement-badge locked" id="badge-4">🌍 Ecosystem Hero</div>
                </div>
            </div>
        </div>

        <div class="aquifer-container">
            <div class="ground-layers" id="ground-layers" onclick="handleClick(event)">
                <div class="layer-label sky">Sky & Atmosphere</div>
                <div class="layer-label topsoil">Topsoil & Vegetation</div>
                <div class="layer-label clay">Clay & Silt Layer</div>
                <div class="layer-label sand">Sand & Gravel Layer</div>
                <div class="layer-label aquifer">Groundwater Aquifer</div>
            </div>

            <div class="mini-map">
                <div class="mini-aquifer" id="mini-aquifer">
                    <div style="position: absolute; bottom: 5px; left: 5px; color: white; font-size: 0.8rem; font-weight: bold;">
                        Mini Map
                    </div>
                </div>
            </div>
        </div>

        <div class="progress-bars">
            <div class="progress-bar">
                <div class="progress-label">💧 Water Level Health</div>
                <div class="progress-track">
                    <div class="progress-fill water-level" id="water-progress" style="width: 85%"></div>
                </div>
                <div style="text-align: center; margin-top: 8px; font-weight: 600; color: #2980b9;">
                    <span id="water-status">Healthy</span>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-label">⚠️ Contamination Risk</div>
                <div class="progress-track">
                    <div class="progress-fill contamination-level" id="contamination-progress" style="width: 5%"></div>
                </div>
                <div style="text-align: center; margin-top: 8px; font-weight: 600; color: #c0392b;">
                    <span id="contamination-status">Low Risk</span>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-label">🌱 Sustainability Score</div>
                <div class="progress-track">
                    <div class="progress-fill sustainability" id="sustainability-progress" style="width: 75%"></div>
                </div>
                <div style="text-align: center; margin-top: 8px; font-weight: 600; color: #27ae60;">
                    <span id="sustainability-status">Good</span>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        let gameState = {
            waterLevel: 85,
            contamination: 5,
            ecoCoins: 1000,
            budget: 50000,
            population: 25000,
            currentScenario: 0,
            scenariosCompleted: 0,
            achievements: ['badge-1'],
            wells: [],
            contaminationSources: [],
            rechargePoints: [],
            monitors: [],
            barriers: [],
            treatmentPlants: [],
            selectedTool: null,
            weather: 'sunny',
            mode: 'scenario',
            quiz: {
                currentQuestion: 0,
                score: 0,
                timeLeft: 30,
                isActive: false,
                answered: false
            }
        };

        const scenarios = [
            {
                icon: "🏜️",
                title: "Drought Crisis Challenge",
                description: "A severe drought has hit your region for the third consecutive year. Groundwater levels are dropping rapidly, agricultural demands are increasing, and the community is demanding immediate action. Your decisions will impact thousands of lives and the ecosystem for decades.",
                choices: [
                    { text: "💧 Implement strict water rationing and conservation programs", impact: { water: +18, coins: +300, contamination: -2 }, sustainable: true, feedback: "Excellent! Conservation reduces demand and protects the aquifer long-term." },
                    { text: "⛏️ Drill deeper wells to access confined aquifers", impact: { water: -12, coins: +80, contamination: +8 }, sustainable: false, feedback: "Short-term gain, but over-extraction damages the ecosystem permanently." },
                    { text: "🚛 Import water from neighboring regions at high cost", impact: { water: +8, coins: -150, contamination: +2 }, sustainable: false, feedback: "Expensive solution that doesn't address the root problem." },
                    { text: "🌧️ Invest in advanced rainwater harvesting systems", impact: { water: +25, coins: +400, contamination: -5 }, sustainable: true, feedback: "Outstanding! Sustainable solution that builds resilience for future droughts." }
                ]
            },
            {
                icon: "🏭",
                title: "Industrial Contamination Crisis",
                description: "A chemical manufacturing plant has been leaking toxic substances into the groundwater for months. The contamination plume is spreading rapidly toward residential wells. Public health is at risk, and immediate action is required.",
                choices: [
                    { text: "🛑 Immediately shut down the factory and begin cleanup", impact: { water: +15, coins: +350, contamination: -20 }, sustainable: true, feedback: "Decisive action! Public health comes first, and cleanup prevents further damage." },
                    { text: "💰 Fine the company heavily but allow continued operation", impact: { water: -8, coins: +120, contamination: +15 }, sustainable: false, feedback: "Fines don't stop contamination. The ecosystem continues to suffer." },
                    { text: "🧪 Install advanced water treatment systems", impact: { water: +12, coins: +250, contamination: -12 }, sustainable: true, feedback: "Good solution! Treatment systems protect water quality effectively." },
                    { text: "⏳ Wait for natural attenuation and dilution", impact: { water: -20, coins: -50, contamination: +25 }, sustainable: false, feedback: "Dangerous gamble! Natural processes are too slow for toxic contamination." }
                ]
            },
            {
                icon: "🏘️",
                title: "Urban Expansion Dilemma",
                description: "A major development company wants to build a new suburb directly over your region's primary aquifer recharge zone. They're offering significant economic benefits and job creation, but the environmental impact could be devastating.",
                choices: [
                    { text: "🚫 Completely reject development to protect the aquifer", impact: { water: +30, coins: +500, contamination: -8 }, sustainable: true, feedback: "Courageous decision! Protecting recharge zones ensures water security for generations." },
                    { text: "🏗️ Allow limited development with strict environmental regulations", impact: { water: +10, coins: +200, contamination: +5 }, sustainable: true, feedback: "Balanced approach! Regulations can minimize environmental impact." },
                    { text: "💵 Approve full development for maximum economic growth", impact: { water: -25, coins: +100, contamination: +20 }, sustainable: false, feedback: "Short-sighted! Economic gains can't replace a destroyed aquifer." },
                    { text: "🌳 Propose alternative green development with water features", impact: { water: +20, coins: +400, contamination: -5 }, sustainable: true, feedback: "Innovative! Green development can actually enhance water recharge." }
                ]
            },
            {
                icon: "🌾",
                title: "Agricultural Water Crisis",
                description: "Local farmers are struggling with crop failures due to water shortages. They're demanding unlimited groundwater access for irrigation, but current usage is already unsustainable. Food security and water security are both at stake.",
                choices: [
                    { text: "🚰 Implement smart irrigation quotas based on crop needs", impact: { water: +15, coins: +280, contamination: -3 }, sustainable: true, feedback: "Smart policy! Efficient irrigation protects both crops and groundwater." },
                    { text: "🌊 Allow unlimited pumping to save this year's harvest", impact: { water: -30, coins: +60, contamination: +12 }, sustainable: false, feedback: "Saving this harvest may destroy future farming possibilities." },
                    { text: "🌱 Subsidize drought-resistant crops and farming techniques", impact: { water: +22, coins: +380, contamination: -6 }, sustainable: true, feedback: "Excellent! Adaptation strategies build long-term agricultural resilience." },
                    { text: "💧 Build expensive desalination plant for irrigation", impact: { water: +8, coins: -200, contamination: +8 }, sustainable: false, feedback: "Costly solution with high energy demands and environmental impact." }
                ]
            }
        ];

        let animationId;
        let weatherInterval;
        let particleInterval;
        let quizTimer;

        const quizQuestions = [
            {
                question: "Which layer typically contains the most groundwater?",
                options: [
                    "Topsoil layer",
                    "Clay layer", 
                    "Sand and gravel layer (aquifer)",
                    "Bedrock layer"
                ],
                correct: 2,
                explanation: "Sand and gravel layers (aquifers) have high porosity and permeability, making them ideal for storing and transmitting groundwater. Clay layers actually act as barriers to water flow."
            },
            {
                question: "What is the main cause of groundwater contamination?",
                options: [
                    "Natural mineral deposits",
                    "Human activities like industrial waste and agriculture",
                    "Rainwater infiltration",
                    "Underground earthquakes"
                ],
                correct: 1,
                explanation: "Human activities such as industrial waste disposal, agricultural chemicals, and improper waste management are the primary sources of groundwater contamination, not natural processes."
            },
            {
                question: "How long does it typically take for groundwater to naturally recharge?",
                options: [
                    "A few days",
                    "Several weeks",
                    "Months to decades",
                    "Over 100 years"
                ],
                correct: 2,
                explanation: "Groundwater recharge is a slow process that can take months to decades depending on soil type, depth, and climate conditions. This is why conservation is so important."
            },
            {
                question: "What percentage of Earth's freshwater is groundwater?",
                options: [
                    "About 10%",
                    "About 30%",
                    "About 50%",
                    "About 70%"
                ],
                correct: 1,
                explanation: "Approximately 30% of Earth's freshwater exists as groundwater, making it a crucial resource for human consumption, agriculture, and ecosystems worldwide."
            },
            {
                question: "Which farming practice helps protect groundwater quality?",
                options: [
                    "Using maximum pesticides for crop protection",
                    "Implementing precision agriculture and organic methods",
                    "Increasing irrigation frequency",
                    "Deep plowing in all seasons"
                ],
                correct: 1,
                explanation: "Precision agriculture and organic farming methods reduce chemical inputs, prevent over-application of fertilizers, and use sustainable practices that protect groundwater from contamination."
            },
            {
                question: "What is an artesian well?",
                options: [
                    "A well dug by hand",
                    "A well that flows naturally due to underground pressure",
                    "A well used only for irrigation",
                    "A well that requires constant pumping"
                ],
                correct: 1,
                explanation: "An artesian well taps into a confined aquifer where water is under pressure, causing it to flow naturally to the surface without pumping. This occurs when the aquifer is sandwiched between impermeable layers."
            },
            {
                question: "Which weather pattern most threatens groundwater levels?",
                options: [
                    "Heavy rainfall",
                    "Moderate temperatures",
                    "Prolonged drought",
                    "Seasonal snow"
                ],
                correct: 2,
                explanation: "Prolonged drought reduces natural recharge while increasing demand for groundwater pumping, leading to aquifer depletion and potential long-term damage to water systems."
            },
            {
                question: "What is the 'cone of depression' in groundwater?",
                options: [
                    "A natural valley where water collects",
                    "The lowered water table around a pumping well",
                    "A type of underground cave system",
                    "The deepest part of an aquifer"
                ],
                correct: 1,
                explanation: "A cone of depression forms when pumping creates a funnel-shaped lowering of the water table around a well. Over-pumping can create large cones that affect neighboring wells and ecosystems."
            },
            {
                question: "Which material makes the best natural water filter?",
                options: [
                    "Clay and silt",
                    "Pure sand",
                    "Layered sand, gravel, and charcoal",
                    "Solid rock"
                ],
                correct: 2,
                explanation: "Layered systems with sand, gravel, and charcoal provide the best natural filtration. Different sized particles remove different contaminants, while charcoal absorbs chemicals and odors."
            },
            {
                question: "What is the biggest threat to future groundwater supplies?",
                options: [
                    "Natural disasters",
                    "Climate change and over-extraction",
                    "Volcanic activity",
                    "Ocean level changes"
                ],
                correct: 1,
                explanation: "Climate change alters precipitation patterns while growing populations increase demand. Over-extraction depletes aquifers faster than they can recharge, creating a sustainability crisis."
            }
        ];

        function switchMode(mode) {
            gameState.mode = mode;
            
            // Update button states
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(mode + '-mode-btn').classList.add('active');
            
            // Show/hide panels
            document.getElementById('scenario-panel').style.display = mode === 'scenario' ? 'block' : 'none';
            document.getElementById('sandbox-panel').style.display = mode === 'sandbox' ? 'block' : 'none';
            document.getElementById('quiz-panel').style.display = mode === 'quiz' ? 'block' : 'none';
            
            if (mode === 'quiz') {
                startQuiz();
            } else {
                stopQuiz();
            }
            
            showNotification(`Switched to ${mode.charAt(0).toUpperCase() + mode.slice(1)} Mode!`, 'success');
        }

        function makeChoice(choiceIndex) {
            const scenario = scenarios[gameState.currentScenario];
            const choice = scenario.choices[choiceIndex];
            const buttons = document.querySelectorAll('.choice-btn');
            
            // Disable all buttons
            buttons.forEach(btn => btn.disabled = true);
            
            // Color the buttons based on sustainability
            buttons.forEach((btn, index) => {
                if (scenario.choices[index].sustainable) {
                    btn.classList.add('good');
                } else {
                    btn.classList.add('bad');
                }
                
                // Highlight the best choice
                if (scenario.choices[index].impact.coins > 300) {
                    btn.classList.add('excellent');
                }
            });
            
            // Apply the impact
            gameState.waterLevel = Math.max(0, Math.min(100, gameState.waterLevel + choice.impact.water));
            gameState.ecoCoins += choice.impact.coins;
            gameState.contamination = Math.max(0, Math.min(100, gameState.contamination + choice.impact.contamination));
            
            // Show detailed feedback
            showNotification(choice.feedback, choice.sustainable ? 'success' : 'warning');
            
            // Check achievements
            checkAchievements();
            
            // Update display
            updateDisplay();
            
            // Next scenario after delay
            setTimeout(() => {
                nextScenario();
            }, 4000);
        }

        function nextScenario() {
            gameState.scenariosCompleted++;
            gameState.currentScenario = (gameState.currentScenario + 1) % scenarios.length;
            
            if (gameState.scenariosCompleted > 0 && gameState.scenariosCompleted % scenarios.length === 0) {
                showNotification(`🎉 Completed full scenario cycle! Bonus: +500 eco-coins! Total: ${gameState.ecoCoins + 500}`, 'success');
                gameState.ecoCoins += 500;
            }
            
            loadScenario();
        }

        function loadScenario() {
            const scenario = scenarios[gameState.currentScenario];
            document.getElementById('scenario-icon').textContent = scenario.icon;
            document.getElementById('scenario-title-text').textContent = scenario.title;
            document.getElementById('scenario-description').textContent = scenario.description;
            
            const buttons = document.querySelectorAll('.choice-btn');
            buttons.forEach((btn, index) => {
                btn.textContent = scenario.choices[index].text;
                btn.disabled = false;
                btn.className = 'choice-btn'; // Reset classes
            });
        }

        function selectTool(tool) {
            // Remove active class from all buttons
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            
            // Add active class to selected button
            document.getElementById(tool + '-btn').classList.add('active');
            
            gameState.selectedTool = tool;
            showNotification(`Selected: ${tool.charAt(0).toUpperCase() + tool.slice(1)} tool - Click on the aquifer to use!`, 'success');
        }

        function handleClick(event) {
            if (gameState.mode !== 'sandbox' || !gameState.selectedTool) {
                if (gameState.mode === 'scenario') {
                    showNotification('Switch to Sandbox Mode to use management tools!', 'warning');
                } else {
                    showNotification('Please select a tool first!', 'warning');
                }
                return;
            }

            const rect = event.currentTarget.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            const xPercent = (x / rect.width) * 100;
            const yPercent = (y / rect.height) * 100;

            switch (gameState.selectedTool) {
                case 'drill':
                    drillWell(xPercent, yPercent);
                    break;
                case 'cleanup':
                    cleanContamination(xPercent, yPercent);
                    break;
                case 'recharge':
                    installRecharge(xPercent, yPercent);
                    break;
                case 'monitor':
                    placeMonitor(xPercent, yPercent);
                    break;
                case 'barrier':
                    installBarrier(xPercent, yPercent);
                    break;
                case 'treatment':
                    installTreatmentPlant(xPercent, yPercent);
                    break;
            }
        }

        function drillWell(x, y) {
            if (gameState.budget < 5000) {
                showNotification('Insufficient budget for drilling! Need $5,000.', 'danger');
                return;
            }

            if (y < 40) {
                showNotification('Cannot drill well in surface layers! Try deeper areas.', 'warning');
                return;
            }

            gameState.budget -= 5000;
            gameState.wells.push({ x, y, pumping: true });
            
            const well = document.createElement('div');
            well.className = 'well';
            well.style.left = x + '%';
            well.style.top = y + '%';
            well.style.height = (100 - y) + '%';
            
            const wellHead = document.createElement('div');
            wellHead.className = 'well-head';
            well.appendChild(wellHead);
            
            document.getElementById('ground-layers').appendChild(well);
            
            // Start water extraction
            if (y > 60) { // In aquifer
                gameState.waterLevel = Math.max(0, gameState.waterLevel - 3);
                gameState.ecoCoins += 50;
                showNotification('Well drilled successfully! Water extraction started. Monitor usage carefully.', 'success');
            } else {
                gameState.contamination += 5;
                showNotification('Well drilled in contaminated layer! Water quality compromised.', 'danger');
            }
            
            updateDisplay();
        }

        function cleanContamination(x, y) {
            if (gameState.budget < 3000) {
                showNotification('Insufficient budget for cleanup! Need $3,000.', 'danger');
                return;
            }

            gameState.budget -= 3000;
            gameState.contamination = Math.max(0, gameState.contamination - 15);
            gameState.ecoCoins += 100;
            
            // Visual cleanup effect
            const cleanup = document.createElement('div');
            cleanup.style.position = 'absolute';
            cleanup.style.left = x + '%';
            cleanup.style.top = y + '%';
            cleanup.style.width = '40px';
            cleanup.style.height = '40px';
            cleanup.style.background = 'radial-gradient(circle, #27ae60, rgba(39, 174, 96, 0.3))';
            cleanup.style.borderRadius = '50%';
            cleanup.style.animation = 'recharge 3s ease-out';
            cleanup.style.pointerEvents = 'none';
            cleanup.style.boxShadow = '0 0 20px rgba(39, 174, 96, 0.6)';
            
            document.getElementById('ground-layers').appendChild(cleanup);
            
            setTimeout(() => cleanup.remove(), 3000);
            
            showNotification('Contamination cleaned successfully! Ecosystem health improving.', 'success');
            updateDisplay();
        }

        function installRecharge(x, y) {
            if (gameState.budget < 8000) {
                showNotification('Insufficient budget for recharge system! Need $8,000.', 'danger');
                return;
            }

            if (y > 30) {
                showNotification('Recharge systems work best near surface! Try higher up.', 'warning');
                return;
            }

            gameState.budget -= 8000;
            gameState.rechargePoints.push({ x, y });
            gameState.waterLevel = Math.min(100, gameState.waterLevel + 8);
            gameState.ecoCoins += 150;
            
            const recharge = document.createElement('div');
            recharge.className = 'recharge-system';
            recharge.style.left = x + '%';
            recharge.style.top = y + '%';
            
            document.getElementById('ground-layers').appendChild(recharge);
            
            showNotification('Recharge system installed! Natural water replenishment enhanced.', 'success');
            updateDisplay();
        }

        function placeMonitor(x, y) {
            if (gameState.budget < 2000) {
                showNotification('Insufficient budget for monitor! Need $2,000.', 'danger');
                return;
            }

            gameState.budget -= 2000;
            gameState.monitors.push({ x, y });
            gameState.ecoCoins += 30;
            
            const monitor = document.createElement('div');
            monitor.className = 'monitor';
            monitor.style.left = x + '%';
            monitor.style.top = y + '%';
            
            document.getElementById('ground-layers').appendChild(monitor);
            
            showNotification('Monitor placed! Real-time water quality tracking enabled.', 'success');
            updateDisplay();
        }

        function installBarrier(x, y) {
            if (gameState.budget < 6000) {
                showNotification('Insufficient budget for barrier! Need $6,000.', 'danger');
                return;
            }

            gameState.budget -= 6000;
            gameState.barriers.push({ x, y });
            gameState.contamination = Math.max(0, gameState.contamination - 8);
            gameState.ecoCoins += 80;
            
            const barrier = document.createElement('div');
            barrier.className = 'barrier';
            barrier.style.left = x + '%';
            barrier.style.top = y + '%';
            
            document.getElementById('ground-layers').appendChild(barrier);
            
            showNotification('Pollution barrier installed! Contamination spread reduced.', 'success');
            updateDisplay();
        }

        function installTreatmentPlant(x, y) {
            if (gameState.budget < 15000) {
                showNotification('Insufficient budget for treatment plant! Need $15,000.', 'danger');
                return;
            }

            if (y < 20 || y > 80) {
                showNotification('Treatment plants need optimal placement in middle layers!', 'warning');
                return;
            }

            gameState.budget -= 15000;
            gameState.treatmentPlants.push({ x, y });
            gameState.contamination = Math.max(0, gameState.contamination - 25);
            gameState.waterLevel = Math.min(100, gameState.waterLevel + 10);
            gameState.ecoCoins += 300;
            
            const plant = document.createElement('div');
            plant.style.position = 'absolute';
            plant.style.left = x + '%';
            plant.style.top = y + '%';
            plant.style.width = '35px';
            plant.style.height = '35px';
            plant.style.background = 'linear-gradient(135deg, #3498db, #2980b9)';
            plant.style.borderRadius = '8px';
            plant.style.border = '4px solid #2980b9';
            plant.style.boxShadow = '0 0 20px rgba(52, 152, 219, 0.6)';
            plant.style.animation = 'recharge 2s ease-in-out infinite';
            
            document.getElementById('ground-layers').appendChild(plant);
            
            showNotification('Water treatment plant installed! Major contamination reduction achieved.', 'success');
            updateDisplay();
        }

        function setWeather(weather) {
            gameState.weather = weather;
            
            // Update button states
            document.querySelectorAll('.weather-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(weather + '-btn').classList.add('active');
            
            // Clear existing weather effects
            document.querySelectorAll('.rain-drop').forEach(drop => drop.remove());
            
            if (weatherInterval) clearInterval(weatherInterval);
            
            switch (weather) {
                case 'rainy':
                    document.getElementById('current-weather').textContent = 'Rainy';
                    startRain();
                    gameState.waterLevel = Math.min(100, gameState.waterLevel + 2);
                    showNotification('Rain activated! Water levels rising naturally.', 'success');
                    break;
                case 'drought':
                    document.getElementById('current-weather').textContent = 'Drought';
                    gameState.waterLevel = Math.max(0, gameState.waterLevel - 2);
                    gameState.contamination = Math.min(100, gameState.contamination + 2);
                    showNotification('Drought conditions! Water stress increasing.', 'warning');
                    break;
                default:
                    document.getElementById('current-weather').textContent = 'Sunny';
                    showNotification('Normal weather conditions restored.', 'success');
            }
            
            updateDisplay();
        }

        function startRain() {
            weatherInterval = setInterval(() => {
                for (let i = 0; i < 8; i++) {
                    const drop = document.createElement('div');
                    drop.className = 'rain-drop';
                    drop.style.left = Math.random() * 100 + '%';
                    drop.style.animationDelay = Math.random() * 2 + 's';
                    document.getElementById('ground-layers').appendChild(drop);
                    
                    setTimeout(() => drop.remove(), 2500);
                }
            }, 150);
        }

        function createWaterParticles() {
            gameState.wells.forEach(well => {
                if (well.pumping && Math.random() < 0.4) {
                    const particle = document.createElement('div');
                    particle.className = 'water-particle';
                    particle.style.left = well.x + '%';
                    particle.style.top = well.y + '%';
                    document.getElementById('ground-layers').appendChild(particle);
                    
                    setTimeout(() => particle.remove(), 4000);
                }
            });

            // Create recharge particles
            gameState.rechargePoints.forEach(point => {
                if (Math.random() < 0.3) {
                    const particle = document.createElement('div');
                    particle.className = 'water-particle';
                    particle.style.left = point.x + '%';
                    particle.style.top = point.y + '%';
                    particle.style.background = 'radial-gradient(circle, #27ae60, #2ecc71)';
                    particle.style.animation = 'waterFlow 5s linear infinite reverse';
                    document.getElementById('ground-layers').appendChild(particle);
                    
                    setTimeout(() => particle.remove(), 5000);
                }
            });
        }

        function simulateContamination() {
            if (Math.random() < 0.015 && gameState.contaminationSources.length < 4) {
                const x = Math.random() * 100;
                const y = 25 + Math.random() * 40; // Between topsoil and sand
                
                gameState.contaminationSources.push({ x, y });
                
                const contamination = document.createElement('div');
                contamination.className = 'contamination';
                contamination.style.left = x + '%';
                contamination.style.top = y + '%';
                document.getElementById('ground-layers').appendChild(contamination);
                
                gameState.contamination = Math.min(100, gameState.contamination + 3);
                showNotification('New contamination source detected! Take action quickly.', 'warning');
            }
        }

        function checkAchievements() {
            if (gameState.ecoCoins >= 2000 && !gameState.achievements.includes('badge-2')) {
                gameState.achievements.push('badge-2');
                document.getElementById('badge-2').classList.remove('locked');
                showNotification('🏆 Achievement Unlocked: Water Guardian! (+200 bonus coins)', 'success');
                gameState.ecoCoins += 200;
            }
            
            if (gameState.ecoCoins >= 4000 && !gameState.achievements.includes('badge-3')) {
                gameState.achievements.push('badge-3');
                document.getElementById('badge-3').classList.remove('locked');
                showNotification('🏆 Achievement Unlocked: Sustainability Master! (+500 bonus coins)', 'success');
                gameState.ecoCoins += 500;
            }

            if (gameState.ecoCoins >= 6000 && gameState.waterLevel > 80 && gameState.contamination < 10 && !gameState.achievements.includes('badge-4')) {
                gameState.achievements.push('badge-4');
                document.getElementById('badge-4').classList.remove('locked');
                showNotification('🏆 Achievement Unlocked: Ecosystem Hero! You\'ve mastered groundwater management! (+1000 bonus coins)', 'success');
                gameState.ecoCoins += 1000;
            }
        }

        function updateDisplay() {
            document.getElementById('water-level').textContent = Math.round(gameState.waterLevel) + '%';
            document.getElementById('contamination-level').textContent = Math.round(gameState.contamination) + '%';
            document.getElementById('eco-coins').textContent = gameState.ecoCoins;
            document.getElementById('budget').textContent = '$' + gameState.budget.toLocaleString();
            document.getElementById('population').textContent = gameState.population.toLocaleString();
            document.getElementById('player-rank').textContent = gameState.ecoCoins;
            
            // Update water tank visual
            document.getElementById('water-tank-fill').style.height = gameState.waterLevel + '%';
            
            // Update progress bars
            document.getElementById('water-progress').style.width = gameState.waterLevel + '%';
            document.getElementById('contamination-progress').style.width = gameState.contamination + '%';
            
            const sustainability = Math.max(0, Math.min(100, gameState.waterLevel - gameState.contamination));
            document.getElementById('sustainability-progress').style.width = sustainability + '%';
            
            // Update status text
            if (gameState.waterLevel > 70) {
                document.getElementById('water-status').textContent = 'Healthy';
            } else if (gameState.waterLevel > 40) {
                document.getElementById('water-status').textContent = 'Moderate';
            } else {
                document.getElementById('water-status').textContent = 'Critical';
            }

            if (gameState.contamination < 20) {
                document.getElementById('contamination-status').textContent = 'Low Risk';
            } else if (gameState.contamination < 50) {
                document.getElementById('contamination-status').textContent = 'Moderate Risk';
            } else {
                document.getElementById('contamination-status').textContent = 'High Risk';
            }

            if (sustainability > 70) {
                document.getElementById('sustainability-status').textContent = 'Excellent';
            } else if (sustainability > 40) {
                document.getElementById('sustainability-status').textContent = 'Good';
            } else {
                document.getElementById('sustainability-status').textContent = 'Needs Improvement';
            }
            
            // Update mini-map
            const miniAquifer = document.getElementById('mini-aquifer');
            miniAquifer.style.background = `linear-gradient(to bottom, 
                #87CEEB 20%, 
                #4682B4 ${20 + (gameState.waterLevel * 0.6)}%)`;
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        function gameLoop() {
            createWaterParticles();
            simulateContamination();
            
            // Natural processes
            if (gameState.weather === 'drought') {
                gameState.waterLevel = Math.max(0, gameState.waterLevel - 0.05);
            } else if (gameState.weather === 'rainy') {
                gameState.waterLevel = Math.min(100, gameState.waterLevel + 0.1);
            }
            
            // Budget income from population
            if (Math.random() < 0.008) {
                const income = Math.floor(gameState.population * 0.05);
                gameState.budget += income;
            }
            
            // Population dynamics based on water quality
            if (gameState.waterLevel > 70 && gameState.contamination < 20) {
                gameState.population = Math.min(100000, gameState.population + Math.floor(Math.random() * 15));
            } else if (gameState.waterLevel < 30 || gameState.contamination > 50) {
                gameState.population = Math.max(10000, gameState.population - Math.floor(Math.random() * 25));
            }
            
            // Recharge system benefits
            gameState.rechargePoints.forEach(() => {
                if (Math.random() < 0.02) {
                    gameState.waterLevel = Math.min(100, gameState.waterLevel + 0.5);
                }
            });

            // Treatment plant benefits
            gameState.treatmentPlants.forEach(() => {
                if (Math.random() < 0.03) {
                    gameState.contamination = Math.max(0, gameState.contamination - 0.5);
                }
            });
            
            updateDisplay();
            checkAchievements();
            
            // Check game over conditions
            if (gameState.waterLevel <= 0) {
                showNotification('🚨 CRITICAL: Aquifer completely depleted! Ecosystem collapse imminent!', 'danger');
            }
            
            if (gameState.contamination >= 100) {
                showNotification('🚨 CRITICAL: Water completely contaminated! Public health emergency!', 'danger');
            }
            
            animationId = requestAnimationFrame(gameLoop);
        }

        // Initialize game
        loadScenario();
        updateDisplay();
        gameLoop();

        // Start particle effects
        particleInterval = setInterval(createWaterParticles, 1000);

        // Add some initial contamination for realism
        setTimeout(() => {
            simulateContamination();
        }, 8000);

        function startQuiz() {
            gameState.quiz = {
                currentQuestion: 0,
                score: 0,
                timeLeft: 30,
                isActive: true,
                answered: false
            };
            
            document.getElementById('quiz-results').style.display = 'none';
            document.getElementById('quiz-explanation').style.display = 'none';
            document.getElementById('quiz-options').style.display = 'grid';
            document.getElementById('quiz-question').style.display = 'block';
            
            loadQuestion();
            startQuizTimer();
        }

        function stopQuiz() {
            if (quizTimer) {
                clearInterval(quizTimer);
                quizTimer = null;
            }
            gameState.quiz.isActive = false;
        }

        function loadQuestion() {
            const question = quizQuestions[gameState.quiz.currentQuestion];
            
            document.getElementById('quiz-question').textContent = question.question;
            document.getElementById('quiz-progress').textContent = `${gameState.quiz.currentQuestion + 1} / ${quizQuestions.length}`;
            document.getElementById('quiz-score').textContent = gameState.quiz.score;
            
            const options = document.querySelectorAll('.quiz-option');
            options.forEach((option, index) => {
                option.textContent = `${String.fromCharCode(65 + index)}) ${question.options[index]}`;
                option.className = 'quiz-option';
                option.disabled = false;
            });
            
            gameState.quiz.answered = false;
            gameState.quiz.timeLeft = 30;
        }

        function startQuizTimer() {
            if (quizTimer) clearInterval(quizTimer);
            
            quizTimer = setInterval(() => {
                gameState.quiz.timeLeft--;
                document.getElementById('quiz-timer').textContent = gameState.quiz.timeLeft + 's';
                
                if (gameState.quiz.timeLeft <= 0) {
                    if (!gameState.quiz.answered) {
                        selectQuizAnswer(-1); // Time's up
                    }
                }
            }, 1000);
        }

        function selectQuizAnswer(selectedIndex) {
            if (gameState.quiz.answered || !gameState.quiz.isActive) return;
            
            gameState.quiz.answered = true;
            clearInterval(quizTimer);
            
            const question = quizQuestions[gameState.quiz.currentQuestion];
            const options = document.querySelectorAll('.quiz-option');
            
            // Disable all options
            options.forEach(option => option.classList.add('disabled'));
            
            // Show correct answer
            options[question.correct].classList.add('correct');
            
            if (selectedIndex === question.correct) {
                gameState.quiz.score++;
                gameState.ecoCoins += 100;
                showNotification('Correct! +100 Eco-Coins earned!', 'success');
            } else {
                if (selectedIndex >= 0) {
                    options[selectedIndex].classList.add('incorrect');
                }
                showNotification(selectedIndex === -1 ? 'Time\'s up!' : 'Incorrect answer. Study the explanation!', 'warning');
            }
            
            // Show explanation
            document.getElementById('explanation-text').textContent = question.explanation;
            document.getElementById('quiz-explanation').style.display = 'block';
            
            updateDisplay();
        }

        function nextQuestion() {
            gameState.quiz.currentQuestion++;
            
            if (gameState.quiz.currentQuestion >= quizQuestions.length) {
                showQuizResults();
            } else {
                document.getElementById('quiz-explanation').style.display = 'none';
                loadQuestion();
                startQuizTimer();
            }
        }

        function showQuizResults() {
            document.getElementById('quiz-options').style.display = 'none';
            document.getElementById('quiz-question').style.display = 'none';
            document.getElementById('quiz-explanation').style.display = 'none';
            document.getElementById('quiz-results').style.display = 'block';
            
            const percentage = Math.round((gameState.quiz.score / quizQuestions.length) * 100);
            document.getElementById('final-score-display').textContent = `${gameState.quiz.score}/${quizQuestions.length} (${percentage}%)`;
            
            const performanceDiv = document.getElementById('performance-message');
            let message, className;
            
            if (percentage >= 80) {
                message = "🌟 Excellent! You're a groundwater expert! Bonus: +500 Eco-Coins!";
                className = "excellent";
                gameState.ecoCoins += 500;
            } else if (percentage >= 60) {
                message = "👍 Good job! You have solid groundwater knowledge. Bonus: +200 Eco-Coins!";
                className = "good";
                gameState.ecoCoins += 200;
            } else {
                message = "📚 Keep learning! Review the explanations and try again.";
                className = "needs-improvement";
            }
            
            performanceDiv.textContent = message;
            performanceDiv.className = `quiz-performance ${className}`;
            
            updateDisplay();
            checkAchievements();
        }

        function restartQuiz() {
            startQuiz();
        }

        // Welcome message
        setTimeout(() => {
            showNotification('🌊 Welcome to AquaFlow Manager V4! Choose your first action in the drought scenario above.', 'success');
        }, 1000);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'974c601985f006bb',t:'MTc1NjEzODM5My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
